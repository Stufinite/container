(function(){var c=$('div.four.menu a.item');c.on('click',function(){$(this).addClass('active').closest('.ui.menu').find('.item').not($(this)).removeClass('active');for(let d of $('div.comments'))'all'==$(this).attr('emotion')?$(d).css('display',''):$(d).attr('emotion')==$(this).attr('emotion')?$(d).css('display',''):$(d).css('display','none')})})(),$(document).ready(function(){async function a(){var f=await function(){return id=location.search.split('id=')[1],new Promise(function(g){$.getJSON('/sloth/get/cvalue?id='+id,function(){}).done(k=>{g(k)})})}();(function(g){let h=$(`
          <div class="eight wide column" id="profile">
            <h3 class="ui header" id='name'></h3>
            <p class="cinema">
              老師：<span id='teacher'></span><br>
              課程類型：<span id='ctype'></span><br>
              上課教材：<span id='book'></span><br>
              開課系所：<span id='dept'></span><br>
              評分方式：<span id='benchmark'></span>
            </p>
            <p>
              <i class="ui red heart outline like icon" aria-hidden="true"></i><span id='feedback_amount'></span>人參與評分
            </p>
          </div>
          <div class="eight wide column" id="chart-container"></div>
        `);h.find('#avatar').attr('src',g.avatar).end().find('#name').text(g.name).end().find('#teacher').text(g.teacher).end().find('#ctype').text(g.ctype).end().find('#book').text(g.book).end().find('#dept').text(g.dept).end().find('#benchmark').text(g.benchmark).end().find('#feedback_amount').text(g.feedback_amount).end(),$('#profile').empty(),$('#profile').append(h),$('.rating').rating('setting','clearable',!0),$('#goquestion').click(function(){return void 0==window.res.id?void toastr.error('\u8ACB\u767B\u5165\u5F8C\u518D\u53C3\u8207\u8A55\u5206'):void $('.modal').modal('show')})})(f),function(g){data=[{axes:[{axis:'\u81EA\u7531',value:g.feedback_freedom},{axis:'\u77E5\u8B58\u6027',value:g.feedback_knowledgeable},{axis:'\u6C1B\u570D',value:g.feedback_FU},{axis:'\u6210\u7E3E',value:g.feedback_GPA},{axis:'\u7C21\u55AE',value:g.feedback_easy}]}],$('#chart-container').empty();var h=RadarChart.chart();h.config({containerClass:'radar-chart',w:200,h:200,factor:0.9,factorLegend:1,levels:5,maxValue:5,minValue:0});var k=d3.select('#chart-container').append('svg').attr('width',200).attr('height',200);k=k.append('g').classed('focus',3).datum(data),k.call(h),d3.selectAll('.axis text').style('font-size','14px')}(f)}(async function(){var f=await function(){return new Promise(function(h){let l='http://login.campass.com.tw';$.ajax({url:l+'/fb/user',dataType:'json',xhrFields:{withCredentials:!0},success:m=>{$('#fb-login-btn').html('<i class="fa fa-facebook-square" aria-hidden="true"></i>\u767B\u51FA').attr('href',l+'/fb/logout?redirect_service=www'),getCookie('id')!=m.id&&$.post('/infernoWeb/createUser',Object.assign(m,{csrfmiddlewaretoken:getCookie('csrftoken')})).done(function(){document.cookie=`id=${m.id}`}).fail(function(n){console.log(n)}),window.res=m,$.post(location.href,Object.assign(m,{csrfmiddlewaretoken:getCookie('csrftoken')})),h(m)},error:()=>{window.res={},h({})}})})}(),g=await function(){return new Promise(function(h){$.getJSON('/sloth/get/comment'+window.location.search+'&start=1',function(l){h(l)})})}();(function(h){$('#comments').empty();for(let k of h){let l=$(`
          <div class="ui comments" emotion="">
            <div class="comment">
              <a class="avatar">
                <img src='/media/student.png'>
              </a>
              <div class="content">
                <b>匿名</b><p class="author"></p>
                <div class="metadata">
                  <div class="date"></div>
                    <div class="rating">
                    </div>
                </div>
                <div class="text">
                  <pre class='raw'></pre>
                </div>
                <a class="ui basic red labeled icon button" value="">
                  <i class="heart icon"></i><span class="like"></span>
                </a>
              </div>
            </div>
          </div>
          `);l.find('div.date').text(k.fields.create).end().find('pre.raw').text(k.fields.raw).end().find('span.like').text(k.fields.like).end().find('a.red.labeled.icon.button').attr('value','/sloth/get/like?id='+k.pk).end().attr('emotion',k.fields.emotion),emojiTable={neutral:'<i class="meh icon"></i>\u4E2D\u7ACB',pos:'<i class="smile icon"></i>\u6B63\u9762',neg:'<i class="frown icon"></i>\u53CD\u9762'},l.find('div.rating').html(emojiTable[k.fields.emotion]);for(let m of k.fields.likesfromuser)window.res.id==m&&(l.find('a').attr('already','True'),l.find('a').removeClass('basic'));$('#comments').append(l)}})(g)})(),a(),$('body').on('click','a.red.labeled.icon.button',function(){var d=$(this);if(void 0==window.res.id)return void toastr.error('\u8ACB\u767B\u5165\u5F8C\u518D\u6309\u8B9A');var e=Object.assign({},res);'True'==d.attr('already')?$.post($(this).attr('value'),Object.assign(e,{csrfmiddlewaretoken:getCookie('csrftoken'),like:-1})).done(function(){tmp=d.find('span.like').text(),d.find('span.like').text(+tmp+-1),d.attr('already','False'),d.addClass('basic')}).fail(function(){toastr.error('\u8ACB\u6AA2\u67E5\u662F\u5426\u767B\u5165\uFF0C\u6216\u662F\u91CD\u65B0\u6574\u7406\u9801\u9762')}):$.post($(this).attr('value'),Object.assign(e,{csrfmiddlewaretoken:getCookie('csrftoken'),like:1})).done(function(){tmp=d.find('span.like').text(),d.find('span.like').text(+tmp+1),d.attr('already','True'),d.removeClass('basic')}).fail(function(){toastr.error('\u8ACB\u6AA2\u67E5\u662F\u5426\u767B\u5165\uFF0C\u6216\u662F\u91CD\u65B0\u6574\u7406\u9801\u9762')})}),$('#questionnaire').click(function(){let c=$('.ui.rating').rating('get rating').map(Number),d={csrfmiddlewaretoken:getCookie('csrftoken'),rating:JSON.stringify(c)};$.post('/sloth/get/questionnaire'+window.location.search,Object.assign(res,d)).done(function(e){!0==e.alreadySubmit?toastr.warning('SORRY \u76EE\u524D\u53EA\u958B\u653E\u63D0\u4EA4\u4E00\u6B21\u5594~~ \u672A\u4F86\u6703\u518D\u4F9D\u7167\u60C5\u6CC1\u8ABF\u6574'):!0==e.submitSuccess?(toastr.success('\u554F\u5377\u63D0\u4EA4\u6210\u529F'),a()):toastr.error('\u767C\u751F\u5947\u602A\u7684\u4E8B\u60C5\uFF0C\u8ACB\u806F\u7D61\u7BA1\u7406\u54E1')}).fail(function(){toastr.error('\u8ACB\u6AA2\u67E5\u662F\u5426\u767B\u5165\u6216\u662F\u91CD\u65B0\u6574\u7406\u9801\u9762')}).always(function(){})})});